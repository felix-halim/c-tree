<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script src="d3.v3.min.js"></script>
<script>
d3.csv('http://localhost:8080/results.csv')

.row(function (d) {
  d.Q = +d.Q;
  d.insert_time = +d.insert_time;
  d.query_time = +d.query_time + 1e-9;
  d.update_time = +d.update_time + 1e-9;
  d.total_time = d.insert_time + d.query_time + d.update_time;
  d.avg_time = d.total_time / d.Q;
  d.qps = d.Q / d.total_time;
  return d;
})

.get(function (error, rows) {
  data = rows;
  var fields = ['algorithm', 'query_workload', 'update_workload', 'selectivity'];
  var s = '<tr>';
  for (var i = 0; i < fields.length; i++) {
    var name = fields[i];
    s += '<th align="left" width="160">' + name + '</th>';
  }
  s += '</tr>';

  var distinct_values = {};
  for (var i = 0; i < data.length; i++) {
    for (var j = 0; j < fields.length; j++) {
      var v = data[i][fields[j]];
      if (!distinct_values[fields[j]]) distinct_values[fields[j]] = {};
      distinct_values[fields[j]][v] = 1;
    }
  }

  s += '<tr>';
  for (var i = 0; i < fields.length; i++) {
    var values = distinct_values[fields[i]];
    s += '<td valign="top"><ul style="margin-left:0; margin-top:0; padding-left:20px; padding-top:0">';
    for (var v in values) if (values.hasOwnProperty(v)) {
      s += '<li>' + v + '</li>';
    }
    s += '</ul></td>';
  }
  s += '</tr>';

  document.getElementById('dimensions').innerHTML = s;
  document.getElementById('config').addEventListener('input', render, false);
  render();

  function render() {
    var ta = document.getElementById('config');
    eval('var opts = ' + ta.value);
    var svg = document.getElementById('chart');
    while (svg.firstChild) svg.removeChild(svg.firstChild);
    linechart(svg, opts);
  }
});

function dl() {
  var svg = document.getElementById('chart');
  $('#p').val(svg.innerHTML);
  $('#svg2pdf').submit();
}
</script>
<script src="linechart.js?13"></script>
<script src="jquery-2.0.3.min.js"></script>
</head>


<body>


<div style="float:left; margin:auto">
  <div id="chart" style="width:500px; height:300px;"></div>
  <form id="svg2pdf" method="post" action="http://uhunt2.felix-halim.net:8000/svg2pdf">
    <input type="text" id="p" name="p" value="" hidden>
    <br>
    <center>
    <button style="clear:both; margin:auto" onclick="dl()">Save as PDF</button>
    </center>
  </form>
</div>

<table id="dimensions" style="" border="0"></table>

<textarea id="config" rows="30" cols="150" style="font-size:12px; clear:both">
{
  width: 475, height: 300,
  xAxis: {
    label: 'Query Sequence',
    attr: 'Q',
    scale: 'log',
    domain: [0.5, 2e9],
    format: 'pow10',
    ticks: [1, 10, 1e2, 1e3, 1e4, 1e5, 1e6, 1e7, 1e8, 1e9],
    margin: 40,
  },
  yAxis: {
    label: 'Timeline (seconds)',
    attr: 'total_time',
    scale: 'log',
    domain: [0.3, 1000],
    format: 'd',
    ticks: [1, 10, 1e2, 1e3],
    margin: 40
  },
  lines: {
    fields : ['algorithm', 'query_workload', 'update_workload', 'N'],
    values : [
//      { label: ['TRIMMER', 120, 210], color:  'blue', line: '', value:['comb_art_1000_1000', 'Random', 'NOUP', 100000000] },
      { label: ['TRIMMER-0',  20, 45], color:  'red', line: '', value:['comb_art_0_0', 'Random', 'NOUP', 100000000] },
      { label: ['TRIMMER-1',  20, 60], color:  'lime', line: '', value:['comb_art_1_1', 'Random', 'NOUP', 100000000] },
      { label: ['TRIMMER-10',  20, 75], color:  'blue', line: '', value:['comb_art_10_1', 'Random', 'NOUP', 100000000] },
      { label: ['TRIMMER-100',  20, 90], color:  'orange', line: '', value:['comb_art_100_1', 'Random', 'NOUP', 100000000] },
      { label: ['TRIMMER-1000',  20, 105], color:  'black', line: '', value:['comb_art_1000_1', 'Random', 'NOUP', 100000000] },
      { label: [   'ARTB', 20,  30], color: 'green', line: '', value:[    'art_best_eager', 'Random', 'NOUP', 100000000] },
//      { label: [   'SORT', 20,  80], color:   'red', line: '', value:[              'sort', 'SkyServer', 'NOUP', 585634221] },
    ],
    group_by: 'algorithm',
  },
}
</textarea>

<br>

<table id="graph-data" style="font-size:11px" border="1"></table>

</body>
</html>
